Running with MPI and wanda pruning method on a single node with 4 GPUs
torch 1.10.1
torch 1.10.1
torch 1.10.1
torch 1.10.1
transformers 4.46.1
transformers 4.46.1
transformers 4.46.1
transformers 4.46.1
accelerate 1.0.1
accelerate accelerate1.0.1 
1.0.1
accelerate 1.0.1
# of gpus:  4
usage: main.py
       [-h]
       [--model MODEL]
       [--seed SEED]
       [--nsamples NSAMPLES]
       [--sparsity_ratio SPARSITY_RATIO]
       [--sparsity_type {unstructured,4:8,2:4}]
       [--prune_method {magnitude,wanda,sparsegpt,ablate_mag_seq,ablate_wanda_seq,ablate_mag_iter,ablate_wanda_iter,search}]
       [--cache_dir CACHE_DIR]
       [--use_variant]
       [--save SAVE]
       [--save_model SAVE_MODEL]
       [--eval_zero_shot]
main.py: error: unrecognized arguments:  
# of gpus:  4
usage: main.py
       [-h]
       [--model MODEL]
       [--seed SEED]
       [--nsamples NSAMPLES]
       [--sparsity_ratio SPARSITY_RATIO]
       [--sparsity_type {unstructured,4:8,2:4}]
       [--prune_method {magnitude,wanda,sparsegpt,ablate_mag_seq,ablate_wanda_seq,ablate_mag_iter,ablate_wanda_iter,search}]
       [--cache_dir CACHE_DIR]
       [--use_variant]
       [--save SAVE]
       [--save_model SAVE_MODEL]
       [--eval_zero_shot]
main.py: error: unrecognized arguments:  
# of gpus:  4
# of gpus:  4
usage: main.py
       [-h]
       [--model MODEL]
       [--seed SEED]
       [--nsamples NSAMPLES]
       [--sparsity_ratio SPARSITY_RATIO]
       [--sparsity_type {unstructured,4:8,2:4}]
       [--prune_method {magnitude,wanda,sparsegpt,ablate_mag_seq,ablate_wanda_seq,ablate_mag_iter,ablate_wanda_iter,search}]
       [--cache_dir CACHE_DIR]
       [--use_variant]
       [--save SAVE]
       [--save_model SAVE_MODEL]
       [--eval_zero_shot]
main.py: error: unrecognized arguments:  
usage: main.py
       [-h]
       [--model MODEL]
       [--seed SEED]
       [--nsamples NSAMPLES]
       [--sparsity_ratio SPARSITY_RATIO]
       [--sparsity_type {unstructured,4:8,2:4}]
       [--prune_method {magnitude,wanda,sparsegpt,ablate_mag_seq,ablate_wanda_seq,ablate_mag_iter,ablate_wanda_iter,search}]
       [--cache_dir CACHE_DIR]
       [--use_variant]
       [--save SAVE]
       [--save_model SAVE_MODEL]
       [--eval_zero_shot]
main.py: error: unrecognized arguments:  
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 2) local_rank: 0 (pid: 3921128) of binary: /Users/918839576/miniconda3/envs/prune_llm/bin/python
torch 1.10.1
transformers 4.46.1
accelerate 1.0.1
torch 1.10.1
transformers 4.46.1
accelerate 1.0.1
torch 1.10.1
torch 1.10.1
transformers 4.46.1
transformers 4.46.1
accelerate 1.0.1
accelerate 1.0.1
# of gpus:  4
usage: main.py
       [-h]
       [--model MODEL]
       [--seed SEED]
       [--nsamples NSAMPLES]
       [--sparsity_ratio SPARSITY_RATIO]
       [--sparsity_type {unstructured,4:8,2:4}]
       [--prune_method {magnitude,wanda,sparsegpt,ablate_mag_seq,ablate_wanda_seq,ablate_mag_iter,ablate_wanda_iter,search}]
       [--cache_dir CACHE_DIR]
       [--use_variant]
       [--save SAVE]
       [--save_model SAVE_MODEL]
       [--eval_zero_shot]
main.py: error: unrecognized arguments:  
# of gpus:  4
usage: main.py
       [-h]
       [--model MODEL]
       [--seed SEED]
       [--nsamples NSAMPLES]
       [--sparsity_ratio SPARSITY_RATIO]
       [--sparsity_type {unstructured,4:8,2:4}]
       [--prune_method {magnitude,wanda,sparsegpt,ablate_mag_seq,ablate_wanda_seq,ablate_mag_iter,ablate_wanda_iter,search}]
       [--cache_dir CACHE_DIR]
       [--use_variant]
       [--save SAVE]
       [--save_model SAVE_MODEL]
       [--eval_zero_shot]
main.py: error: unrecognized arguments:  
# of gpus:  4
usage: main.py
       [-h]
       [--model MODEL]
       [--seed SEED]
       [--nsamples NSAMPLES]
       [--sparsity_ratio SPARSITY_RATIO]
       [--sparsity_type {unstructured,4:8,2:4}]
       [--prune_method {magnitude,wanda,sparsegpt,ablate_mag_seq,ablate_wanda_seq,ablate_mag_iter,ablate_wanda_iter,search}]
       [--cache_dir CACHE_DIR]
       [--use_variant]
       [--save SAVE]
       [--save_model SAVE_MODEL]
       [--eval_zero_shot]
main.py: error: unrecognized arguments:  
# of gpus:  4
usage: main.py
       [-h]
       [--model MODEL]
       [--seed SEED]
       [--nsamples NSAMPLES]
       [--sparsity_ratio SPARSITY_RATIO]
       [--sparsity_type {unstructured,4:8,2:4}]
       [--prune_method {magnitude,wanda,sparsegpt,ablate_mag_seq,ablate_wanda_seq,ablate_mag_iter,ablate_wanda_iter,search}]
       [--cache_dir CACHE_DIR]
       [--use_variant]
       [--save SAVE]
       [--save_model SAVE_MODEL]
       [--eval_zero_shot]
main.py: error: unrecognized arguments:  
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 2) local_rank: 0 (pid: 3921157) of binary: /Users/918839576/miniconda3/envs/prune_llm/bin/python
torch 1.10.1
torch 1.10.1
torch 1.10.1
transformers 4.46.1
transformers 4.46.1
torch 1.10.1
accelerate 1.0.1
accelerate 1.0.1
transformers 4.46.1
transformers 4.46.1
accelerate 1.0.1
accelerate 1.0.1
# of gpus:  4
usage: main.py
       [-h]
       [--model MODEL]
       [--seed SEED]
       [--nsamples NSAMPLES]
       [--sparsity_ratio SPARSITY_RATIO]
       [--sparsity_type {unstructured,4:8,2:4}]
       [--prune_method {magnitude,wanda,sparsegpt,ablate_mag_seq,ablate_wanda_seq,ablate_mag_iter,ablate_wanda_iter,search}]
       [--cache_dir CACHE_DIR]
       [--use_variant]
       [--save SAVE]
       [--save_model SAVE_MODEL]
       [--eval_zero_shot]
main.py: error: unrecognized arguments:  
# of gpus:  4
usage: main.py
       [-h]
       [--model MODEL]
       [--seed SEED]
       [--nsamples NSAMPLES]
       [--sparsity_ratio SPARSITY_RATIO]
       [--sparsity_type {unstructured,4:8,2:4}]
       [--prune_method {magnitude,wanda,sparsegpt,ablate_mag_seq,ablate_wanda_seq,ablate_mag_iter,ablate_wanda_iter,search}]
       [--cache_dir CACHE_DIR]
       [--use_variant]
       [--save SAVE]
       [--save_model SAVE_MODEL]
       [--eval_zero_shot]
main.py: error: unrecognized arguments:  
# of gpus:  4
usage: main.py
       [-h]
       [--model MODEL]
       [--seed SEED]
       [--nsamples NSAMPLES]
       [--sparsity_ratio SPARSITY_RATIO]
       [--sparsity_type {unstructured,4:8,2:4}]
       [--prune_method {magnitude,wanda,sparsegpt,ablate_mag_seq,ablate_wanda_seq,ablate_mag_iter,ablate_wanda_iter,search}]
       [--cache_dir CACHE_DIR]
       [--use_variant]
       [--save SAVE]
       [--save_model SAVE_MODEL]
       [--eval_zero_shot]
main.py: error: unrecognized arguments:  
# of gpus:  4
usage: main.py
       [-h]
       [--model MODEL]
       [--seed SEED]
       [--nsamples NSAMPLES]
       [--sparsity_ratio SPARSITY_RATIO]
       [--sparsity_type {unstructured,4:8,2:4}]
       [--prune_method {magnitude,wanda,sparsegpt,ablate_mag_seq,ablate_wanda_seq,ablate_mag_iter,ablate_wanda_iter,search}]
       [--cache_dir CACHE_DIR]
       [--use_variant]
       [--save SAVE]
       [--save_model SAVE_MODEL]
       [--eval_zero_shot]
main.py: error: unrecognized arguments:  
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 2) local_rank: 0 (pid: 3921187) of binary: /Users/918839576/miniconda3/envs/prune_llm/bin/python
torch 1.10.1
transformers 4.46.1
accelerate 1.0.1
torch 1.10.1
transformers 4.46.1
accelerate 1.0.1
torch 1.10.1
transformers 4.46.1
accelerate 1.0.1
torch 1.10.1
transformers 4.46.1
accelerate 1.0.1
# of gpus:  4
usage: main.py
       [-h]
       [--model MODEL]
       [--seed SEED]
       [--nsamples NSAMPLES]
       [--sparsity_ratio SPARSITY_RATIO]
       [--sparsity_type {unstructured,4:8,2:4}]
       [--prune_method {magnitude,wanda,sparsegpt,ablate_mag_seq,ablate_wanda_seq,ablate_mag_iter,ablate_wanda_iter,search}]
       [--cache_dir CACHE_DIR]
       [--use_variant]
       [--save SAVE]
       [--save_model SAVE_MODEL]
       [--eval_zero_shot]
main.py: error: unrecognized arguments:  
# of gpus:  4
usage: main.py
       [-h]
       [--model MODEL]
       [--seed SEED]
       [--nsamples NSAMPLES]
       [--sparsity_ratio SPARSITY_RATIO]
       [--sparsity_type {unstructured,4:8,2:4}]
       [--prune_method {magnitude,wanda,sparsegpt,ablate_mag_seq,ablate_wanda_seq,ablate_mag_iter,ablate_wanda_iter,search}]
       [--cache_dir CACHE_DIR]
       [--use_variant]
       [--save SAVE]
       [--save_model SAVE_MODEL]
       [--eval_zero_shot]
main.py: error: unrecognized arguments:  
# of gpus:  4
# of gpus:  4
usage: main.py
       [-h]
       [--model MODEL]
       [--seed SEED]
       [--nsamples NSAMPLES]
       [--sparsity_ratio SPARSITY_RATIO]
       [--sparsity_type {unstructured,4:8,2:4}]
       [--prune_method {magnitude,wanda,sparsegpt,ablate_mag_seq,ablate_wanda_seq,ablate_mag_iter,ablate_wanda_iter,search}]
       [--cache_dir CACHE_DIR]
       [--use_variant]
       [--save SAVE]
       [--save_model SAVE_MODEL]
       [--eval_zero_shot]
main.py: error: unrecognized arguments:  
usage: main.py
       [-h]
       [--model MODEL]
       [--seed SEED]
       [--nsamples NSAMPLES]
       [--sparsity_ratio SPARSITY_RATIO]
       [--sparsity_type {unstructured,4:8,2:4}]
       [--prune_method {magnitude,wanda,sparsegpt,ablate_mag_seq,ablate_wanda_seq,ablate_mag_iter,ablate_wanda_iter,search}]
       [--cache_dir CACHE_DIR]
       [--use_variant]
       [--save SAVE]
       [--save_model SAVE_MODEL]
       [--eval_zero_shot]
main.py: error: unrecognized arguments:  
ERROR:torch.distributed.elastic.multiprocessing.api:failed (exitcode: 2) local_rank: 0 (pid: 3921215) of binary: /Users/918839576/miniconda3/envs/prune_llm/bin/python
Traceback (most recent call last):
  File "/Users/918839576/miniconda3/envs/prune_llm/bin/torchrun", line 33, in <module>
    sys.exit(load_entry_point('torch==1.10.1', 'console_scripts', 'torchrun')())
  File "/Users/918839576/miniconda3/envs/prune_llm/lib/python3.9/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 345, in wrapper
    return f(*args, **kwargs)
  File "/Users/918839576/miniconda3/envs/prune_llm/lib/python3.9/site-packages/torch/distributed/run.py", line 719, in main
    run(args)
  File "/Users/918839576/miniconda3/envs/prune_llm/lib/python3.9/site-packages/torch/distributed/run.py", line 710, in run
    elastic_launch(
  File "/Users/918839576/miniconda3/envs/prune_llm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 131, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/Users/918839576/miniconda3/envs/prune_llm/lib/python3.9/site-packages/torch/distributed/launcher/api.py", line 259, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
./main.py FAILED
------------------------------------------------------------
Failures:
[1]:
  time      : 2024-11-01_03:28:43
  host      : gpu01.hpc.at.sfsu.edu
  rank      : 1 (local_rank: 1)
  exitcode  : 2 (pid: 3921216)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[2]:
  time      : 2024-11-01_03:28:43
  host      : gpu01.hpc.at.sfsu.edu
  rank      : 2 (local_rank: 2)
  exitcode  : 2 (pid: 3921217)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
[3]:
  time      : 2024-11-01_03:28:43
  host      : gpu01.hpc.at.sfsu.edu
  rank      : 3 (local_rank: 3)
  exitcode  : 2 (pid: 3921218)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2024-11-01_03:28:43
  host      : gpu01.hpc.at.sfsu.edu
  rank      : 0 (local_rank: 0)
  exitcode  : 2 (pid: 3921215)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
--------------------------------------------------------------------------
Primary job  terminated normally, but 1 process returned
a non-zero exit code. Per user-direction, the job has been aborted.
--------------------------------------------------------------------------
--------------------------------------------------------------------------
mpirun detected that one or more processes exited with non-zero status, thus causing
the job to be terminated. The first process to do so was:

  Process name: [[49747,1],0]
  Exit code:    1
--------------------------------------------------------------------------
/var/spool/slurm/d/job02450/slurm_script: line 25: --model: command not found
Finished wanda pruning with MPI on a single node
